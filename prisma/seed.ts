import { PrismaClient, Role, OrderStatus } from '@prisma/client';
import * as bcrypt from 'bcryptjs';

const prisma = new PrismaClient();

async function main() {
  console.log('üå± Iniciando seeding de la base de datos...');

  // Limpiar datos existentes
  await prisma.review.deleteMany();
  await prisma.favorite.deleteMany();
  await prisma.order.deleteMany();
  await prisma.promotion.deleteMany();
  await prisma.encargado.deleteMany();
  await prisma.user.deleteMany();
  await prisma.category.deleteMany();

  // Crear categor√≠as
  console.log('üìÇ Creando categor√≠as...');
  const categories = [
    {
      id: 'hogar',
      name: 'Hogar',
      icon: 'üè°',
      color: '#8B5CF6',
      description: 'Servicios para el hogar',
      services: ['Limpieza', 'Plomer√≠a', 'Electricidad', 'Carpinter√≠a'],
    },
    {
      id: 'belleza',
      name: 'Belleza',
      icon: '‚ú®',
      color: '#F97316',
      description: 'Servicios de belleza y cuidado personal',
      services: ['Peluquer√≠a', 'Manicure', 'Masajes', 'Est√©tica'],
    },
    {
      id: 'educacion',
      name: 'Educaci√≥n',
      icon: 'üéì',
      color: '#3B82F6',
      description: 'Servicios educativos y tutor√≠as',
      services: ['Tutor√≠as', 'Clases particulares', 'Idiomas'],
    },
    {
      id: 'cuidado',
      name: 'Cuidado Infantil',
      icon: 'üë∂',
      color: '#EAB308',
      description: 'Cuidado de ni√±os y beb√©s',
      services: ['Ni√±era', 'Cuidado de beb√©s', 'Actividades infantiles'],
    },
    {
      id: 'tecnologia',
      name: 'Tecnolog√≠a',
      icon: '‚ö°',
      color: '#EF4444',
      description: 'Servicios tecnol√≥gicos',
      services: ['Reparaci√≥n PC', 'Instalaci√≥n software', 'Soporte t√©cnico'],
    },
    {
      id: 'profesionales',
      name: 'Profesionales',
      icon: 'üéØ',
      color: '#22C55E',
      description: 'Servicios profesionales',
      services: ['Contabilidad', 'Legal', 'Consultor√≠a'],
    },
    {
      id: 'mascotas',
      name: 'Mascotas',
      icon: 'üêï',
      color: '#14B8A6',
      description: 'Cuidado de mascotas',
      services: ['Veterinaria', 'Peluquer√≠a canina', 'Paseo de perros'],
    },
    {
      id: 'mas',
      name: 'M√°s',
      icon: '‚öôÔ∏è',
      color: '#6B7280',
      description: 'Otros servicios',
      services: ['Otros'],
    },
  ];

  for (const category of categories) {
    await prisma.category.create({ data: category });
  }

  // Crear usuario administrador
  console.log('üëë Creando usuario administrador...');
  const hashedPassword = await bcrypt.hash('123456', 12);
  
  const adminUser = await prisma.user.create({
    data: {
      name: 'Administrador',
      email: 'admin@encargate.com',
      password: hashedPassword,
      role: Role.ADMIN,
      avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face&auto=format',
      phone: '+57 300 000 0000',
      location: 'Bogot√° D.C.',
      verified: true,
    },
  });
  console.log(`‚úÖ Admin creado: ${adminUser.email}`);

  // Crear usuarios cliente
  console.log('üë§ Creando usuarios cliente...');
  
  const users = [
    {
      name: 'Juan Jim√©nez',
      email: 'jpjimenez94@gmail.com',
      password: hashedPassword,
      role: Role.CLIENTE,
      avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face&auto=format',
      phone: '+57 300 123 4567',
      location: 'Bogot√° D.C.',
      verified: true,
    },
    {
      name: 'Mar√≠a Garc√≠a',
      email: 'maria.garcia@email.com',
      password: hashedPassword,
      role: Role.CLIENTE,
      avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=150&h=150&fit=crop&crop=face&auto=format',
      phone: '+57 301 987 6543',
      location: 'Medell√≠n',
      verified: true,
    },
  ];

  const createdUsers = [];
  for (const user of users) {
    const createdUser = await prisma.user.create({ data: user });
    createdUsers.push(createdUser);
  }

  // Crear encargados
  console.log('üîß Creando encargados...');
  const encargados = [
    {
      name: 'Miguel Paredes',
      email: 'miguel.paredes@email.com',
      password: hashedPassword,
      avatar: 'https://images.unsplash.com/photo-1582750433449-648ed127bb54?w=150&h=150&fit=crop&crop=face&auto=format',
      location: 'Bogot√° D.C.',
      verified: true,
      service: 'Plomer√≠a',
      categoryId: 'hogar',
      price: 254.99,
      priceMin: 50,
      priceMax: 300,
      rating: 5.0,
      reviewsCount: 127,
      experience: '5 a√±os',
      description: 'Plomero certificado con amplia experiencia en reparaciones residenciales y comerciales.',
      services: ['Reparaci√≥n de tuber√≠as', 'Instalaci√≥n de grifos', 'Destapado de ca√±er√≠as'],
      available: true,
    },
    {
      name: 'Juli√°n Herrera',
      email: 'julian.herrera@email.com',
      password: hashedPassword,
      avatar: 'https://images.unsplash.com/photo-1607990281513-2c110a25bd8c?w=150&h=150&fit=crop&crop=face&auto=format',
      location: 'Medell√≠n',
      verified: true,
      service: 'Electricista',
      categoryId: 'hogar',
      price: 354.99,
      priceMin: 80,
      priceMax: 500,
      rating: 5.0,
      reviewsCount: 89,
      experience: '8 a√±os',
      description: 'Electricista profesional especializado en instalaciones residenciales y comerciales.',
      services: ['Instalaci√≥n el√©ctrica', 'Reparaci√≥n de circuitos', 'Iluminaci√≥n LED'],
      available: true,
    },
    {
      name: 'Andr√©s Salazar',
      email: 'andres.salazar@email.com',
      password: hashedPassword,
      avatar: 'https://images.unsplash.com/photo-1581092921461-eab62e97a780?w=150&h=150&fit=crop&crop=face&auto=format',
      location: 'Cali',
      verified: true,
      service: 'Carpinter√≠a',
      categoryId: 'hogar',
      price: 264.99,
      priceMin: 100,
      priceMax: 400,
      rating: 5.0,
      reviewsCount: 156,
      experience: '10 a√±os',
      description: 'Carpintero experto en muebles a medida y reparaciones de madera.',
      services: ['Muebles a medida', 'Reparaci√≥n de puertas', 'Instalaci√≥n de closets'],
      available: false,
    },
    {
      name: 'Carolina L√≥pez',
      email: 'carolina.lopez@email.com',
      password: hashedPassword,
      avatar: 'https://images.unsplash.com/photo-1594824388853-e0c5c9e1e4c5?w=150&h=150&fit=crop&crop=face&auto=format',
      location: 'Bogot√° D.C.',
      verified: true,
      service: 'Peluquer√≠a',
      categoryId: 'belleza',
      price: 180.00,
      priceMin: 50,
      priceMax: 250,
      rating: 4.8,
      reviewsCount: 203,
      experience: '6 a√±os',
      description: 'Estilista profesional especializada en cortes modernos y coloraci√≥n.',
      services: ['Corte de cabello', 'Coloraci√≥n', 'Peinados para eventos'],
      available: true,
    },
    {
      name: 'Roberto Mart√≠nez',
      email: 'roberto.martinez@email.com',
      password: hashedPassword,
      avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face&auto=format',
      location: 'Medell√≠n',
      verified: true,
      service: 'Soporte T√©cnico',
      categoryId: 'tecnologia',
      price: 120.00,
      priceMin: 60,
      priceMax: 200,
      rating: 4.9,
      reviewsCount: 78,
      experience: '4 a√±os',
      description: 'T√©cnico en sistemas especializado en reparaci√≥n de computadores y redes.',
      services: ['Reparaci√≥n PC', 'Instalaci√≥n software', 'Configuraci√≥n redes'],
      available: true,
    },
  ];

  const createdEncargados = [];
  for (const encargado of encargados) {
    const createdEncargado = await prisma.encargado.create({ data: encargado });
    createdEncargados.push(createdEncargado);
  }

  // Crear promociones
  console.log('üéâ Creando promociones...');
  const promotions = [
    {
      title: '40% OFF',
      subtitle: 'Limpieza Profunda',
      description: 'Descuento especial en servicios de limpieza para el hogar',
      discount: 40,
      category: 'hogar',
      color: 'purple',
      gradient: 'from-purple-500 to-purple-600',
      active: true,
      validUntil: new Date('2024-12-31'),
      image: 'https://images.unsplash.com/photo-1581578731548-c64695cc6952?w=100&h=100&fit=crop&auto=format',
    },
    {
      title: '15% OFF',
      subtitle: 'Servicios',
      description: 'Descuento en todos los servicios profesionales',
      discount: 15,
      category: 'all',
      color: 'blue',
      gradient: 'from-blue-500 to-blue-600',
      active: true,
      validUntil: new Date('2024-11-30'),
      image: 'https://images.unsplash.com/photo-1581092795360-fd1ca04f0952?w=100&h=100&fit=crop&auto=format',
    },
    {
      title: '25% OFF',
      subtitle: 'Primera Vez',
      description: 'Descuento especial para nuevos usuarios',
      discount: 25,
      category: 'all',
      color: 'green',
      gradient: 'from-green-500 to-green-600',
      active: true,
      validUntil: new Date('2024-12-15'),
      image: 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=100&h=100&fit=crop&auto=format',
    },
  ];

  for (const promotion of promotions) {
    await prisma.promotion.create({ data: promotion });
  }

  // Crear pedidos de ejemplo
  console.log('üìã Creando pedidos de ejemplo...');
  const orders = [
    {
      userId: createdUsers[0].id,
      encargadoId: createdEncargados[0].id,
      categoryId: 'hogar',
      service: 'Reparaci√≥n de tuber√≠a',
      description: 'Reparaci√≥n urgente en la cocina',
      address: 'Calle 123 #45-67, Bogot√°',
      date: new Date('2024-03-15'),
      time: '10:00 AM',
      status: OrderStatus.COMPLETED,
      price: 254.99,
      paymentMethod: 'tarjeta',
    },
    {
      userId: createdUsers[0].id,
      encargadoId: createdEncargados[1].id,
      categoryId: 'hogar',
      service: 'Instalaci√≥n el√©ctrica',
      description: 'Instalaci√≥n de nuevos puntos de luz',
      address: 'Carrera 45 #67-89, Bogot√°',
      date: new Date('2024-04-20'),
      time: '2:00 PM',
      status: OrderStatus.PENDING,
      price: 354.99,
      paymentMethod: 'efectivo',
    },
  ];

  const createdOrders = [];
  for (const order of orders) {
    const createdOrder = await prisma.order.create({ data: order });
    createdOrders.push(createdOrder);
  }

  // Crear rese√±as
  console.log('‚≠ê Creando rese√±as...');
  const reviews = [
    {
      orderId: createdOrders[0].id,
      userId: createdUsers[0].id,
      encargadoId: createdEncargados[0].id,
      rating: 5,
      comment: 'Excelente servicio, muy profesional y puntual.',
    },
  ];

  for (const review of reviews) {
    await prisma.review.create({ data: review });
  }

  // Crear algunos favoritos
  console.log('‚ù§Ô∏è Creando favoritos...');
  const favorites = [
    {
      userId: createdUsers[0].id,
      encargadoId: createdEncargados[0].id,
    },
    {
      userId: createdUsers[0].id,
      encargadoId: createdEncargados[3].id,
    },
  ];

  for (const favorite of favorites) {
    await prisma.favorite.create({ data: favorite });
  }

  console.log('‚úÖ Seeding completado exitosamente!');
  console.log('\nüìä Datos creados:');
  console.log(`- ${categories.length} categor√≠as`);
  console.log(`- ${users.length} usuarios cliente`);
  console.log(`- ${encargados.length} encargados`);
  console.log(`- ${promotions.length} promociones`);
  console.log(`- ${orders.length} pedidos`);
  console.log(`- ${reviews.length} rese√±as`);
  console.log(`- ${favorites.length} favoritos`);
  
  console.log('\nüîë Credenciales de prueba:');
  console.log('Cliente: jpjimenez94@gmail.com / 123456');
  console.log('Encargados: miguel.paredes@email.com / 123456');
  console.log('           julian.herrera@email.com / 123456');
  console.log('           carolina.lopez@email.com / 123456');
}

main()
  .catch((e) => {
    console.error('‚ùå Error durante el seeding:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
